
**CloudFront**는 AWS의 **CDN (Content Delivery Network)** 서비스이다. **정적 컨텐츠**를 전세계 엣지 로케이션에 캐싱하여 **빠른 응답과 낮은 레이턴시**를 제공할 수 있다.

![[Pasted image 20250510214537.png]]

### 엣지 로케이션

- 전세계 **216개 이상의 엣지 로케이션** 존재 -> 거점이라고 보면 된다.
- 사용자 요청은 **가장 가까운 엣지에서 처리**
- 엣지에 컨텐츠가 없다면, 원본(S3 등)에서 가져와 **로컬 캐시에 저장**

### 장점
1. 사용자 경험 개선
   캐싱을 통해 **지연시간 감소**, 글로벌 사용자에게 **빠르고 일관된 응답**
2. DDoS 대응
   분산되어 있으니 자연스럽게 가능하고, AWS의 **Shield, WAF** 등과 함께 사용 가능

## 동작 방식

1. 클라이언트 → 가까운 **엣지 로케이션**에 요청
2. 엣지가 캐시 확인 → 없으면 **원본 서버(S3 등)**에서 가져옴
3. 가져온 데이터는 **로컬에 캐싱**
4. 다음 요청부터는 **엣지에서 바로 제공**

## 어떤 것을 Origin으로 설정할 수 있나?

- **S3 버킷**: CloudFront가 접근할 수 있도록 **OAC (Origin Access Control)** 설정 필요 (기존 OAI 대체)
- **HTTP 백엔드**: ALB, EC2, 정적 S3 웹사이트 등도 가능

## 예시 시나리오

- 호주 S3 버킷 → 미국 사용자
    - 최초 요청: 미국 엣지 → 호주 S3에서 컨텐츠 가져옴
    - 이후 요청: 미국 엣지에서 바로 제공
- 상파울루 사용자 → 가까운 브라질 엣지 → 내부망으로 원본 접근

## CloudFront vs S3 교차 리전 복제 (CRR)

|항목|CloudFront|S3 CRR|
|---|---|---|
|목적|정적 컨텐츠 전송|버킷 복제|
|위치|전세계 엣지|명시된 리전|
|업데이트|하루 단위 캐싱|거의 실시간 복제|
|캐싱|O|X|
|읽기 전용|X|O|
|사용 예|글로벌 사용자 대상 웹 컨텐츠|특정 리전 간 데이터 동기화|

---

## 1. EC2 인스턴스를 Origin으로 사용하는 경우

### 아키텍처 구성

- 클라이언트 → **엣지 로케이션** → **CloudFront** → **EC2 HTTP 서버**

### 조건

- **CloudFront 엣지는 퍼블릭 네트워크**
- 따라서 **EC2 인스턴스도 퍼블릭**이어야 접근 가능
- CloudFront는 VPC(가상 네트워크) 안에서 동작하지 않음

### 보안 설정

- EC2의 **보안 그룹(Security Group)**에서  
    **CloudFront의 모든 공용 IP 범위**를 허용해야 함

## 2. ALB를 Origin으로 사용하는 경우

### 아키텍처 구성

- 클라이언트 → **엣지 로케이션** → **CloudFront** → **ALB** → **EC2 (Private)**

### 조건

- **ALB는 퍼블릭 설정**
- **EC2 인스턴스는 프라이빗 네트워크 가능**

### 보안 설정

- ALB와 EC2 간에는 **VPC 내부 통신**이 가능
- EC2 보안 그룹에서 **ALB를 허용**해주면 됨

---

## CloudFront - 지리적 제한 (Geo Restriction)

사용자 IP를 기반으로 위치를 판별해서 특정 **국가 단위로 CloudFront 배포 접근을 제한**하는 기능이다. GeoIP DB를 사용한다.

## 설정 방식

### 1. 허용 목록 (Allow list)

- **명시된 국가만 접근 가능**
- 나머지 국가는 모두 차단됨

### 2. 차단 목록 (Block list)

- **명시된 국가만 접근 차단**
- 나머지 국가는 모두 접근 가능

## 사용 사례

- **저작권 제한 콘텐츠** 접근 제어
- **서비스 지역 제한**
- 특정 국가에서만 사용 가능한 웹 애플리케이션 배포

---
## CloudFront 고급 옵션

### 요금 (Pricing)

- **엣지 로케이션의 위치**에 따라 **데이터 전송 비용**이 다름   
- 전송량이 많을수록 GB당 비용이 낮아짐

## 가격 등급 (Price Class)

- **비용 절감을 위해 사용할 엣지 로케이션을 제한**할 수 있음
- 엣지 수가 적어질수록 성능은 낮아지지만, **비용은 절감**

### 등급별 구분

|Price Class|사용 리전|특징|
|---|---|---|
|**All**|전 세계|최상 성능, 비용 ↑|
|**200**|북미, 유럽, 일부 아시아|성능-비용 균형|
|**100**|북미, 유럽|비용 최소화, 성능 ↓|

## 요약

- 엣지 위치별로 데이터 전송 비용이 상이함
- **Price Class 설정**으로 원하는 **성능/비용 균형 조정** 가능
- 비용을 아끼고 싶다면 **Price Class 100**,  
    최적 성능이 필요하다면 **Price Class All**

---

## CloudFront 캐시 무효화 (Cache Invalidation)

 **CloudFront 엣지 로케이션**은 컨텐츠를 캐싱하는데, Origin이 업데이트되어도 엣지는 **자동으로 갱신되지 않고** TTL(Time To Live) 만료 시에만 갱신된다.

## 필요성

- 업데이트된 콘텐츠를 **즉시 반영**하고 싶을 때 사용
- TTL을 기다리지 않고 **강제로 캐시 삭제** 가능

## 무효화 방식

### 특정 경로 지정

- 예시:
    - `/index.html` → 특정 파일 무효화
    - `/images/*` → 특정 디렉토리 내 전체 무효화
- 와일드카드(`*`) 사용 가능

## 동작 원리

1. 관리자가 S3 오리진 콘텐츠 업데이트
2. 캐시에 존재하는 파일들은 여전히 **기존 버전**
3. CloudFront에 무효화 요청
    - `/index.html`
    - `/images/*`
4. 각 엣지 로케이션이 해당 경로의 캐시를 제거
5. 이후 사용자 요청 시 → 캐시 없음 → 오리진에서 **최신 버전 로드**

## 예시 시나리오

|단계|동작|
|---|---|
|1|S3에 `index.html`과 이미지 업데이트|
|2|TTL 남아 있어 엣지는 여전히 이전 버전 보유|
|3|`/index.html`과 `/images/*` 경로 무효화 요청|
|4|CloudFront 엣지에서 해당 캐시 제거|
|5|사용자 요청 시 오리진에서 최신 파일 받아옴|

## 주의사항

- 무효화 요청은 **요금이 부과**될 수 있음 (요청 수 초과 시)
- TTL 값을 **짧게 설정하거나**, 무효화를 **부분적으로만** 사용하는 것이 효율적


