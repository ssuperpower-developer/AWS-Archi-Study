
## 🔄 오토 스케일링 그룹(Auto Scaling Group)이란?

실제 상황에서 웹사이트와 애플리케이션의 부하는 변할 수 있다.

클라우드에서는 서버를 매우 빠르게 생성하고 제거할 수 있는 것이 클라우드의 장점이다.

오토 스케일링 그룹(ASG)의 목표는 다음과 같아요:

- 증가된 부하에 맞게 스케일 아웃(EC2 인스턴스 추가)
- 감소된 부하에 맞게 스케일 인(EC2 인스턴스 제거)
- 실행 중인 EC2 인스턴스의 최소 및 최대 수를 확보
- 새 인스턴스를 로드 밸런서에 자동으로 등록 (ASG에 속한 인스턴스는 로드 밸런서에 연결되기 때문이다)
- 이전 인스턴스가 종료된 경우 EC2 인스턴스 재생성 (예: 비정상인 경우)

ASG는 무료이다 (기본 EC2 인스턴스에 대해서만 비용을 지불)
![[스크린샷 2025-05-03 오후 10.59.33.png]]

이 예시의 경우 용량은 7이다. 

## 🏭 로드 밸런서가 있는 AWS의 오토 스케일링 그룹

ELB는 EC2 인스턴스의 상태를 확인할 수 있어요!

비정상 인스턴스를 감지하고 새 인스턴스로 대체한다.

## 📋 오토 스케일링 그룹 속성

ASG에는 다음과 같은 구성 요소가 필요하다:

**시작 템플릿(Template)** (이전의 "시작 구성"은 더 이상 사용되지 않음):

- AMI + 인스턴스 유형
- EC2 사용자 데이터
- EBS 볼륨
- 보안 그룹
- SSH 키 페어
- EC2 인스턴스용 IAM 역할
- 네트워크 + 서브넷 정보
- 로드 밸런서 정보

아래는 추가적인 필요 설정이다.:

- 최소 크기 / 최대 크기 / 초기 용량
- 스케일링 정책

## 📊 오토 스케일링 - CloudWatch 경보 & 스케일링

CloudWatch 경보를 기반으로 ASG를 스케일링할 수 있다.


경보는 메트릭(예: **평균 CPU** 또는 **사용자 지정 메트릭**)을 모니터링한다.
평균 CPU와 같은 메트릭은 전체 ASG 인스턴스로 계산 하는 것이다.!

% 메트릭은 데이터 지표라고 생각하면 된다. 

경보를 기반으로 다음과 같은 작업을 수행한다.

- 스케일 아웃 정책 생성 (인스턴스 수 증가)
- 스케일 인 정책 생성 (인스턴스 수 감소)

## 📈 오토 스케일링 그룹 - 스케일링 정책

**동적 스케일링**:

- **대상 추적 스케일링**:
    - 설정이 간단하다
    - 예: 평균 ASG CPU를 약 40%로 유지
- **단순/단계 스케일링**:
    - CloudWatch 경보가 트리거될 때 (예: CPU > 70%), 2개 단위 추가
    - CloudWatch 경보가 트리거될 때 (예: CPU < 30%), 1개 단위 제거

**예약 스케일링**:

- 알려진 사용 패턴에 기반한 스케일링 예상
- 예: 금요일 오후 5시에 최소 용량을 10으로 증가

**예측 스케일링**:

- 부하를 지속적으로 예측하고 미리 스케일링 일정을 잡는다.

## 📉 스케일링에 좋은 메트릭

- **CPUUtilization**: 인스턴스 전체의 평균 CPU 사용률
- **RequestCountPerTarget**: EC2 인스턴스당 요청 수가 안정적인지 확인하기 위해
- **평균 네트워크 입/출력**: 애플리케이션이 네트워크 바인딩된 경우
- **사용자 지정 메트릭**: CloudWatch를 사용하여 푸시하는 모든 메트릭


# 🔄 오토 스케일링 그룹 - 스케일링 쿨다운

스케일링 활동이 발생한 후, **쿨다운 기간**(기본값 300초)이 있다. 운동 후 휴식 시간 같은거라 생각하면 된다 🏃‍♀️

쿨다운 기간 동안, ASG는 메트릭이 안정화될 시간을 주기 위해 추가 인스턴스를 시작하거나 종료하지 않는 것이 특징이다.

**TIP**: 구성 시간을 줄이기 위해 바로 사용 가능한 AMI를 사용하면 요청을 더 빨리 처리하고 쿨다운 기간을 줄일 수 있어요!

```
스케일링 활동 발생 → 기본 쿨다운 적용 중? → 예: 작업 무시 / 아니오: 인스턴스 시작 또는 종료
```

