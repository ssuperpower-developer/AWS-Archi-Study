
AWS의 도메인 네임 시스템(DNS) 서비스인 Route 53에 대해 알아보자

## 🔍 DNS란 무엇인가? - 인터넷의 전화번호부

#### DNS

DNS(Domain Name System)는 우리가 기억하기 쉬운 도메인 이름([www.google.com)을](http://www.google.com\)%EC%9D%84) 컴퓨터가 이해할 수 있는 IP 주소(172.217.18.36)로 변환해주는 시스템이다. 

쉽게 비유하자면, 우리가 친구 이름으로 전화번호를 찾는 것처럼, 컴퓨터도 도메인 이름으로 IP 주소를 찾는 것이다📱

DNS는 인터넷의 backbone(중추)이며, 계층적인 이름 구조를 사용한다. 

```
.com
└── example.com
    ├── api.example.com
    └── www.example.com
```

## 📚 DNS 용어 정리

시험에 자주 나온다:

#### 1. 도메인 등록기관(Domain Registrar) 🏢

- Amazon Route 53, GoDaddy 같은 곳들
- 여기서 도메인 이름을 구매하고 등록한다.

#### 2. DNS 레코드 📝

- A, AAAA, CNAME, NS 등등...
- 도메인과 IP를 연결하는 정보들

#### 3. Zone 파일 📂

- DNS 레코드들을 담고 있는 파일
- 도메인의 모든 DNS 정보가 여기 있다

### 4. 네임 서버(Name Server) 🖥️

- DNS 쿼리를 해결하는 서버
- Authoritative(권한 있는)와 Non-Authoritative(권한 없는)로 나뉩니다

### 5. TLD(Top Level Domain) 🔝

- .com, .org, .kr 같은 최상위 도메인

### 6. SLD(Second Level Domain) 🥈

- amazon.com, google.com에서 'amazon', 'google' 부분

#### 🔄 DNS가 실제로 어떻게 작동하는지 같이 따라가보자

브라우저에 example.com을 입력했다고 해보자:

1. **웹 브라우저**: "example.com이 뭔지 알려줘!"
2. **로컬 DNS 서버**: "잠깐만... 내 캐시에 있나 볼게... 없네? Root DNS에 물어볼게!"
3. **Root DNS 서버**: ".com은 이 TLD DNS 서버가 관리해!"
4. **TLD DNS 서버**: "example.com은 이 SLD DNS 서버가 관리해!"
5. **SLD DNS 서버**: "example.com의 IP는 9.10.11.12야!"
6. **로컬 DNS 서버**: "알겠어요! (캐시에 저장) 브라우저야, IP는 9.10.11.12야!"
7. **웹 브라우저**: "땡쓰! 이제 그 IP로 접속할게"

이 과정에서 TTL(Time To Live)이라는 게 중요한데, 이건 DNS 정보가 캐시에 얼마나 오래 저장될지 정하는 것이다. 

## 🚀 Amazon Route 53 소개 - AWS의 DNS 서비스

#### Route 53의 특징

- 고가용성, 확장 가능한 완전 관리형 DNS 서비스
- **Authoritative DNS** - 우리가 DNS 레코드를 직접 관리할 수 있다는 말이다.
- 도메인 등록기관(Domain Registrar) 역할도 함 (도메인 구매 가능)
- 헬스 체크 기능 제공
- **100% 가용성 SLA** - AWS 서비스 중 유일
-  DNS 포트 번호가 53이라서 53이다. 

### 📝 Route 53 레코드 완벽 가이드

Route 53에서 트래픽을 어떻게 라우팅할지 정의하는 게 바로 레코드이다

#### 레코드의 구성 요소

1. **도메인/서브도메인 이름**: example.com
2. **레코드 타입**: A, AAAA, CNAME, NS 등
3. **값**: 12.34.56.78 같은 IP 주소
4. **라우팅 정책**: Route 53이 쿼리에 응답하는 방식
5. **TTL**: DNS 리졸버에서 레코드가 캐시하는 시간

#### 주요 레코드 타입 (시험에 자주 나온다 📝)

- **A**: 호스트네임 → IPv4
- **AAAA**: 호스트네임 → IPv6
- **CNAME**: 호스트네임 → 다른 호스트네임(매핑)
    - ⚠️ 주의: Zone Apex(최상위 도메인)에는 사용 불가!
    - example.com 에 CNAME을 만들 수 없다❌ / [www.example.com](http://www.example.com) ✅
- **NS**: 호스팅 영역의 네임 서버 정보

### 🏠 호스팅 영역(Hosted Zones) - DNS 레코드의 집

호스팅 영역은 DNS 레코드들을 담는 컨테이너이다.

#### 두 가지 타입
![[스크린샷 2025-05-04 오후 8.34.08.png]]
1. **퍼블릭 호스팅 영역**
    - 인터넷 트래픽 라우팅용
    - 예: application1.mypublicdomain.com
2. **프라이빗 호스팅 영역**
    - VPC 내부 트래픽 라우팅용
    - 공개되지 않은 도메인 네임
    - 예: application1.company.internal

💰 비용: 호스팅 영역당 월 $0.50

실습) 도메인 네임을 등록하고 -> hosted zone에 가서 레코드를 만든다 (이름, 레코드 타입, 주소값을 적는다) 

Ec2 연결하기
서로 다른 region에 ec2를 두고 로드 밸런서를 둔다. 
로드 밸런서를 만들때 Listeners and routing이 있는데 여기서 target group을 생성한다. 

### ⏰ TTL

TTL(Time To Live)은 DNS 응답이 캐시되는 시간이다.
![[스크린샷 2025-05-04 오후 8.52.06.png]]
##### 높은 TTL vs 낮은 TTL

**높은 TTL (예: 24시간)**

- ✅ Route 53 트래픽 감소 (비용 절감)
- ❌ 레코드 업데이트가 느림

**낮은 TTL (예: 60초)**

- ❌ Route 53 트래픽 증가 (비용 증가 💸)
- ✅ 레코드 업데이트가 빠름
- ✅ 레코드 변경이 쉬움

💡  Alias 레코드를 제외한 모든 DNS 레코드에 TTL은 필수이다

#### 🔀 CNAME vs Alias 

##### CNAME 레코드

- 호스트네임을 다른 호스트네임으로 매핑
- **루트 도메인에는 사용 불가** (중요! ⚠️)
- 예: app.mydomain.com → blabla.anything.com

##### Alias 레코드

- 호스트네임을 AWS 리소스로 매핑
- **루트 도메인에도 사용 가능** ✅
- 무료! (CNAME은 쿼리마다 과금)
- 네이티브 헬스 체크 지원
- TTL 설정 불가
- 항상 A/AAAA 타입만 가능

##### Alias가 지원하는 AWS 리소스들

- ELB, CloudFront, API Gateway
- Elastic Beanstalk, S3 웹사이트
- VPC 인터페이스 엔드포인트
- Global Accelerator
- 동일 호스팅 영역의 Route 53 레코드

⚠️ **주의**: EC2 DNS 이름에는 Alias 설정 불가!

=) EC2 DNS 이름 : 인스턴스를 생성하면 AWS가 자동으로 할당해주는 public DNS 이름이다. 

## 🎯 라우팅 정책

"라우팅"이라고 해서 로드 밸런서처럼 트래픽을 라우팅한다고 생각하시면 안 된다. DNS는 쿼리에 응답만 할 뿐이다. (클라이언트는 이를 통해 http 쿼리 등을 어떻게 처리할 수 있는지를 알게 되는 것이다. )

라우팅 정책은 Route 53가 DNS 쿼리에 응답하는 것을 돕는다. (레코드 만들 때 정한다)

##### 1️⃣ Simple (단순)
![[스크린샷 2025-05-04 오후 10.00.48.png]]
- 기본적인 라우팅 방식
- 여러 값을 반환하면 클라이언트가 랜덤 선택
- 헬스 체크 연결 불가 ❌

##### 2️⃣ Weighted (가중치)
![[스크린샷 2025-05-04 오후 10.03.06.png]]
- 각 리소스로 가는 트래픽 비율 제어
- 가중치 합이 100일 필요 없음!
- 가중치 0 = 트래픽 중단
- 사용 사례: 새 버전 테스트(적은 양의 트래픽을 보내서), 지역 간 로드 밸런싱

##### 3️⃣ Latency-based (지연 시간)

- 가장 낮은 지연 시간을 가진 리소스로 리디렉션
- value 값의 리전을 명시해주고 레코드를 만들어야 한다.
- 사용자와 AWS 리전 간 트래픽으로 측정
- 독일 사용자가 미국 리전으로 갈 수도 있다

##### 4️⃣ Failover (장애 조치)
![[스크린샷 2025-05-04 오후 10.18.11.png]]
- Primary(기본)와 Secondary(보조) 구성 <- 우선 순위를 명확하게한 정책이라고 보면 된다. 
- Active-Passive 방식
- Primary 헬스 체크 실패 시 Secondary로 자동 전환

##### 5️⃣ Geolocation (지리적 위치)

- 사용자 위치 기반 라우팅
- 대륙, 국가, 미국 주 단위 설정 가능(나라를 선택할 수 있다)
- **Default 레코드 필수!** (매칭 안될 때 사용)
- 사용 사례: 콘텐츠 현지화, 배포 제한

##### 6️⃣ Geoproximity (지리적 근접성)

- 리소스와 사용자의 지리적 위치 기반
- **Bias(편향)** 값으로 트래픽 조절
    - 확장(1~99): 더 많은 트래픽
    - 축소(-1~-99): 더 적은 트래픽
- Route 53 Traffic Flow 필요
![[스크린샷 2025-05-04 오후 10.24.11.png]]
편향 값이 0인경우

![[스크린샷 2025-05-04 오후 10.24.33.png]]
분할선이 왼쪽으로 

> 특정 리전에 더 많은 트래픽을 보내야 한다고 할 때 사용하면 된다. 

##### 7️⃣ IP-based (IP 기반)
![[스크린샷 2025-05-04 오후 10.26.54.png]]
- 클라이언트 IP 주소 기반 라우팅
- CIDR 블록으로 IP 그룹 정의
- 사용 사례: ISP별 최적화, 네트워크 비용 절감(IP 주소를 미리 알고 있기 때문에 값이 싸다)

##### 8️⃣ Multi-Value (다중값)

- 여러 리소스로 트래픽 라우팅
- 헬스 체크 가능 (건강한 리소스만 반환)
- 최대 8개 레코드 반환
- **ELB 대체제는 아님!**

### 🏥 헬스 체크 

##### 헬스 체크 타입 3가지

##### 1. 엔드포인트 모니터링

- 약 15개 글로벌 헬스 체커 사용
- 기본 설정: 30초 간격으로 확인 or 비용 더 내서 짧게 헬스체크 간격을 둘 수 있음 
- 18% 이상이 "건강"하다고 판단하면 → 건강!
- 2xx, 3xx 상태 코드만 건강으로 인정
- 중요: Route 53 헬스 체커 IP 허용 필요!

##### 2. 계산된 헬스 체크 (Calculated Health Checks)
![[스크린샷 2025-05-04 오후 10.11.38.png]]
- 여러 헬스 체크 결과를 하나로 합쳐주는 기능 
- OR, AND, NOT 연산을 사용하여 합친다. 
- 최대 256개 하위 헬스 체크 가능

##### 3. CloudWatch 알람 모니터링 (Private Hosted Zones)
![[스크린샷 2025-05-04 오후 10.13.41.png]]
- 프라이빗 리소스 모니터링에 유용! (다른 모든 Route 53의 health check는 public web에 있기 때문에 VPC 외부에 있어 프라이빗에는 사용이 불가하다 )
- DynamoDB, RDS, 커스텀 메트릭 등 체크 가능

